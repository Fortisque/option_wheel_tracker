{% extends "base_generic.html" %}

{% load filter_tags %}

{% block content %}
  <h1>Option Wheel: {{ wheel }}</h1>
  <a href="{% url 'wheels' %}">All Wheels</a>
  <p>All computation is done per share on this page. Multiply profits and collateral by 100 * quantity, since each contract is 100 shares</p>
  <p>
    <strong>Cost Basis:</strong> ${{ cost_basis }}
    <strong>Quantity:</strong> {{ wheel.quantity }}
    <strong>Active:</strong> {{ wheel.is_active }}
  </p>
  {% if wheel.is_active %}
  <p>
    <div>
      <strong>Profit If Exits Here:</strong> ${{ profit_if_exits_here }}
    </div>
    <div>
      <strong>Rate Of Return If Exits Here:</strong> {{ decimal_rate_of_return | percentage }}
    </div>
    <div>
      <strong>Annualized Rate Of Return If Exits Here:</strong> {{ annualized_rate_of_return_if_exits_here | floatformat:2 }}x
    </div>
    <div>
      <strong>Days Active So Far:</strong> {{ days_active_so_far }}
    </div>
  </p>
  {% endif %}
  <br>
  <br>

  <p>
    <strong>Current Price:</strong> ${{ current_price | floatformat:2 }}
  </p>

  {% if expires %}
    <p><i class="text-danger">Warning: Set to expire on <strong>{{ expires | date:"m/d"}}</strong>. Check back then to take the next action.</i></p>
  {% endif %}

  <strong>Status:</strong>
  {% if wheel.is_active %}
    {% if purchases %}
      {% if expires %}<i> If expires now, </i>{% endif %}
      {% if purchases.0.call_or_put == 'P' and current_price < purchases.0.strike %}
        <span class="badge badge-pill badge-primary">Put {% if not expires %} Pending {% endif %} Assignment</span>
      {% elif purchases.0.call_or_put == 'P' %}
        <span class="badge badge-pill badge-success">Put {% if not expires %} Pending {% endif %} Expiration</span>
      {% elif current_price < purchases.0.strike %}
        <span class="badge badge-pill badge-primary">Call {% if not expires %} Pending {% endif %} Expiration</span>
      {% else%}
        <span class="badge badge-pill badge-success">Call {% if not expires %} Pending {% endif %} Assignment</span>
      {% endif %}
      <div>
        <div class="card mt-2 d-inline-flex">
          <div class="card-body">
            <h5 class="card-title">Possible Actions</h5>
            <a type="button" class="btn btn-primary" href="{% url 'purchase-create' wheel_id=wheel.pk %}">
              {% if purchases.0.call_or_put == 'P' %} Put Assigned {% else %} Call Expired {% endif %} - Add Call
            </a>
            <a type="button" class="btn btn-success" href="{% url 'wheel-complete' pk=wheel.pk %}">
              {% if purchases.0.call_or_put == 'P' %} Put Expired {% else %} Call Assigned {% endif %} - Complete Wheel
            </a>
          </div>
        </div>
      <div>
    {% else %}
      <i> No purchases yet.</i>
      <div>
        <a type="button" class="btn btn-primary" href="{% url 'purchase-create' wheel_id=wheel.pk %}">Add First Purchase</a>
      <div>
    {% endif %}
  {% else %}
    <i> Complete.</i>
    <div>
      <strong>Rate Of Return:</strong> {{ decimal_rate_of_return | percentage }}
    </div>
    <div>
      <strong>Total Days Active:</strong> {{ wheel.total_days_active }}
    </div>
    <div>
      <strong>Annualized Rate Of Return:</strong> {{ annualized_rate_of_return_if_exits_here | floatformat:2 }}x
    </div>
    <div>
      <strong>Profit:</strong> ${{ wheel.total_profit }}
      {% if wheel.quantity > 1 %} (${{ wheel.total_profit | multiply:wheel.quantity | floatformat:2}} total) {% endif %}
    </div>
    <div>
      <strong>Collatoral:</strong> {{ wheel.collatoral }}
    </div>
    <div>
      <a type="button" class="btn btn-warning" href="{% url 'wheel-reactivate' pk=wheel.pk %}">Reactivate Wheel</a>
    </div>
  {% endif %}

  <br>
  <br>

  <ul>
    {% for purchase in purchases %}
      <li>
        <a href="{{ purchase.get_absolute_url }}">{{ purchase }}</a>
        Purchased on {{ purchase.purchase_date | date:"m/d" }} for
      <strong>${{ purchase.premium }}</strong> premium
      <i>({{ wheel.stock_ticker }} at ${{ purchase.price_at_date }})</i>
      </li>
    {% endfor %}
  </ul>

  <br>
  <a type="button" class="btn btn-primary" href="{% url 'wheel-update' pk=wheel.pk %}">Edit</a>
  <a type="button" class="btn btn-danger" href="{% url 'wheel-delete' pk=wheel.pk %}" variant="danger">Delete</a>

{% endblock %}
